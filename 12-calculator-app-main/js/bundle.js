(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var __assign=function(){return __assign=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},__assign.apply(this,arguments)},ActionTypes,SpecialTargets;function __rest(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}function __values(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}function __spreadArray(t,e,n){if(n||2===arguments.length)for(var i,r=0,o=e.length;r<o;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}!function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"}(ActionTypes||(ActionTypes={})),function(t){t.Parent="#_parent",t.Internal="#_internal"}(SpecialTargets||(SpecialTargets={}));var start$1=ActionTypes.Start,stop$1=ActionTypes.Stop,raise$1=ActionTypes.Raise,send$1=ActionTypes.Send,cancel$1=ActionTypes.Cancel,nullEvent=ActionTypes.NullEvent,assign$2=ActionTypes.Assign;ActionTypes.After,ActionTypes.DoneState;var log=ActionTypes.Log,init=ActionTypes.Init,invoke=ActionTypes.Invoke;ActionTypes.ErrorExecution;var errorPlatform=ActionTypes.ErrorPlatform,error$1=ActionTypes.ErrorCustom,update=ActionTypes.Update,choose=ActionTypes.Choose,pure=ActionTypes.Pure,STATE_DELIMITER=".",EMPTY_ACTIVITY_MAP={},DEFAULT_GUARD_TYPE="xstate.guard",TARGETLESS_KEY="",IS_PRODUCTION=!0,_a;function matchesState(t,e,n){void 0===n&&(n=STATE_DELIMITER);var i=toStateValue(t,n),r=toStateValue(e,n);return isString(r)?!!isString(i)&&r===i:isString(i)?i in r:Object.keys(i).every((function(t){return t in r&&matchesState(i[t],r[t])}))}function getEventType(t){try{return isString(t)||"number"==typeof t?"".concat(t):t.type}catch(t){throw new Error("Events must be strings or objects with a string event.type property.")}}function toStatePath(t,e){try{return isArray(t)?t:t.toString().split(e)}catch(e){throw new Error("'".concat(t,"' is not a valid state path."))}}function isStateLike(t){return"object"==typeof t&&"value"in t&&"context"in t&&"event"in t&&"_event"in t}function toStateValue(t,e){return isStateLike(t)?t.value:isArray(t)?pathToStateValue(t):"string"!=typeof t?t:pathToStateValue(toStatePath(t,e))}function pathToStateValue(t){if(1===t.length)return t[0];for(var e={},n=e,i=0;i<t.length-1;i++)i===t.length-2?n[t[i]]=t[i+1]:(n[t[i]]={},n=n[t[i]]);return e}function mapValues(t,e){for(var n={},i=Object.keys(t),r=0;r<i.length;r++){var o=i[r];n[o]=e(t[o],o,t,r)}return n}function mapFilterValues(t,e,n){var i,r,o={};try{for(var a=__values(Object.keys(t)),s=a.next();!s.done;s=a.next()){var c=s.value,u=t[c];n(u)&&(o[c]=e(u,c,t))}}catch(t){i={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o}var path=function(t){return function(e){var n,i,r=e;try{for(var o=__values(t),a=o.next();!a.done;a=o.next()){r=r[a.value]}}catch(t){n={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return r}};function nestedPath(t,e){return function(n){var i,r,o=n;try{for(var a=__values(t),s=a.next();!s.done;s=a.next()){var c=s.value;o=o[e][c]}}catch(t){i={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o}}function toStatePaths(t){return t?isString(t)?[[t]]:flatten(Object.keys(t).map((function(e){var n=t[e];return"string"==typeof n||n&&Object.keys(n).length?toStatePaths(t[e]).map((function(t){return[e].concat(t)})):[[e]]}))):[[]]}function flatten(t){var e;return(e=[]).concat.apply(e,__spreadArray([],__read(t),!1))}function toArrayStrict(t){return isArray(t)?t:[t]}function toArray(t){return void 0===t?[]:toArrayStrict(t)}function mapContext(t,e,n){var i,r;if(isFunction(t))return t(e,n.data);var o={};try{for(var a=__values(Object.keys(t)),s=a.next();!s.done;s=a.next()){var c=s.value,u=t[c];isFunction(u)?o[c]=u(e,n.data):o[c]=u}}catch(t){i={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o}function isBuiltInEvent(t){return/^(done|error)\./.test(t)}function isPromiseLike(t){return t instanceof Promise||!(null===t||!isFunction(t)&&"object"!=typeof t||!isFunction(t.then))}function isBehavior(t){return null!==t&&"object"==typeof t&&"transition"in t&&"function"==typeof t.transition}function partition(t,e){var n,i,r=__read([[],[]],2),o=r[0],a=r[1];try{for(var s=__values(t),c=s.next();!c.done;c=s.next()){var u=c.value;e(u)?o.push(u):a.push(u)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return[o,a]}function updateHistoryStates(t,e){return mapValues(t.states,(function(t,n){if(t){var i=(isString(e)?void 0:e[n])||(t?t.current:void 0);if(i)return{current:i,states:updateHistoryStates(t,i)}}}))}function updateHistoryValue(t,e){return{current:e,states:updateHistoryStates(t,e)}}function updateContext(t,e,n,i){var r=t?n.reduce((function(t,n){var r,o,a=n.assignment,s={state:i,action:n,_event:e},c={};if(isFunction(a))c=a(t,e.data,s);else try{for(var u=__values(Object.keys(a)),l=u.next();!l.done;l=u.next()){var h=l.value,d=a[h];c[h]=isFunction(d)?d(t,e.data,s):d}}catch(t){r={error:t}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}return Object.assign({},t,c)}),t):t;return r}var warn=function(){};function isArray(t){return Array.isArray(t)}function isFunction(t){return"function"==typeof t}function isString(t){return"string"==typeof t}function toGuard(t,e){if(t)return isString(t)?{type:DEFAULT_GUARD_TYPE,name:t,predicate:e?e[t]:void 0}:isFunction(t)?{type:DEFAULT_GUARD_TYPE,name:t.name,predicate:t}:t}function isObservable(t){try{return"subscribe"in t&&isFunction(t.subscribe)}catch(t){return!1}}var symbolObservable=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function isMachine(t){return!!t&&"__xstatenode"in t}function isActor$1(t){return!!t&&"function"==typeof t.send}function toEventObject(t,e){return isString(t)||"number"==typeof t?__assign({type:t},e):t}function toSCXMLEvent(t,e){if(!isString(t)&&"$$type"in t&&"scxml"===t.$$type)return t;var n=toEventObject(t);return __assign({name:n.type,data:n,$$type:"scxml",type:"external"},e)}function toTransitionConfigArray(t,e){return toArrayStrict(e).map((function(e){return void 0===e||"string"==typeof e||isMachine(e)?{target:e,event:t}:__assign(__assign({},e),{event:t})}))}function normalizeTarget(t){if(void 0!==t&&t!==TARGETLESS_KEY)return toArray(t)}function evaluateGuard(t,e,n,i,r){var o=t.options.guards,a={state:r,cond:e,_event:i};if(e.type===DEFAULT_GUARD_TYPE)return((null==o?void 0:o[e.name])||e.predicate)(n,i.data,a);var s=null==o?void 0:o[e.type];if(!s)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return s(n,i.data,a)}function toInvokeSource$1(t){return"string"==typeof t?{type:t}:t}function toObserver(t,e,n){var i=function(){},r="object"==typeof t,o=r?t:null;return{next:((r?t.next:t)||i).bind(o),error:((r?t.error:e)||i).bind(o),complete:((r?t.complete:n)||i).bind(o)}}function createInvokeId(t,e){return"".concat(t,":invocation[").concat(e,"]")}_a={},_a[symbolObservable]=function(){return this},_a[Symbol.observable]=function(){return this};var initEvent=toSCXMLEvent({type:init});function getActionFunction(t,e){return e&&e[t]||void 0}function toActionObject(t,e){var n;if(isString(t)||"number"==typeof t)n=isFunction(i=getActionFunction(t,e))?{type:t,exec:i}:i||{type:t,exec:void 0};else if(isFunction(t))n={type:t.name||t.toString(),exec:t};else{var i;if(isFunction(i=getActionFunction(t.type,e)))n=__assign(__assign({},t),{exec:i});else if(i){var r=i.type||t.type;n=__assign(__assign(__assign({},i),t),{type:r})}else n=t}return n}var toActionObjects=function(t,e){return t?(isArray(t)?t:[t]).map((function(t){return toActionObject(t,e)})):[]};function toActivityDefinition(t){var e=toActionObject(t);return __assign(__assign({id:isString(t)?t:e.id},e),{type:e.type})}function raise(t){return isString(t)?{type:raise$1,event:t}:send(t,{to:SpecialTargets.Internal})}function resolveRaise(t){return{type:raise$1,_event:toSCXMLEvent(t.event)}}function send(t,e){return{to:e?e.to:void 0,type:send$1,event:isFunction(t)?t:toEventObject(t),delay:e?e.delay:void 0,id:e&&void 0!==e.id?e.id:isFunction(t)?t.name:getEventType(t)}}function resolveSend(t,e,n,i){var r,o={_event:n},a=toSCXMLEvent(isFunction(t.event)?t.event(e,n.data,o):t.event);if(isString(t.delay)){var s=i&&i[t.delay];r=isFunction(s)?s(e,n.data,o):s}else r=isFunction(t.delay)?t.delay(e,n.data,o):t.delay;var c=isFunction(t.to)?t.to(e,n.data,o):t.to;return __assign(__assign({},t),{to:c,_event:a,event:a.data,delay:r})}var resolveLog=function(t,e,n){return __assign(__assign({},t),{value:isString(t.expr)?t.expr:t.expr(e,n.data,{_event:n})})},cancel=function(t){return{type:cancel$1,sendId:t}};function start(t){var e=toActivityDefinition(t);return{type:ActionTypes.Start,activity:e,exec:void 0}}function stop(t){var e=isFunction(t)?t:toActivityDefinition(t);return{type:ActionTypes.Stop,activity:e,exec:void 0}}function resolveStop(t,e,n){var i=isFunction(t.activity)?t.activity(e,n.data):t.activity,r="string"==typeof i?{id:i}:i;return{type:ActionTypes.Stop,activity:r}}var assign$1=function(t){return{type:assign$2,assignment:t}};function after(t,e){var n=e?"#".concat(e):"";return"".concat(ActionTypes.After,"(").concat(t,")").concat(n)}function done(t,e){var n="".concat(ActionTypes.DoneState,".").concat(t),i={type:n,data:e,toString:function(){return n}};return i}function doneInvoke(t,e){var n="".concat(ActionTypes.DoneInvoke,".").concat(t),i={type:n,data:e,toString:function(){return n}};return i}function error(t,e){var n="".concat(ActionTypes.ErrorPlatform,".").concat(t),i={type:n,data:e,toString:function(){return n}};return i}function resolveActions(t,e,n,i,r,o,a){void 0===a&&(a=!1);var s=__read(a?[[],r]:partition(r,(function(t){return t.type===assign$2})),2),c=s[0],u=s[1],l=c.length?updateContext(n,i,c,e):n,h=a?[n]:void 0,d=flatten(u.map((function(n){var r;switch(n.type){case raise$1:return resolveRaise(n);case send$1:var s=resolveSend(n,l,i,t.options.delays);return s.to!==SpecialTargets.Internal&&(null==o||o(s,l,i)),s;case log:var c=resolveLog(n,l,i);return null==o||o(c,l,i),c;case choose:if(!(p=null===(r=n.conds.find((function(n){var r=toGuard(n.cond,t.options.guards);return!r||evaluateGuard(t,r,l,i,o?void 0:e)})))||void 0===r?void 0:r.actions))return[];var u=__read(resolveActions(t,e,l,i,toActionObjects(toArray(p),t.options.actions),o,a),2),d=u[0],f=u[1];return l=f,null==h||h.push(l),d;case pure:var p;if(!(p=n.get(l,i.data)))return[];var v=__read(resolveActions(t,e,l,i,toActionObjects(toArray(p),t.options.actions),o,a),2),y=v[0],g=v[1];return l=g,null==h||h.push(l),y;case stop$1:c=resolveStop(n,l,i);return null==o||o(c,l,i),c;case assign$2:l=updateContext(l,i,[n],o?void 0:e),null==h||h.push(l);break;default:var _=toActionObject(n,t.options.actions),S=_.exec;if(o)o(_,l,i);else if(S&&h){var m=h.length-1;_=__assign(__assign({},_),{exec:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];S.apply(void 0,__spreadArray([h[m]],__read(e),!1))}})}return _}})).filter((function(t){return!!t})));return[d,l]}var provide=function(t,e){return e(t)};function createNullActor(t){var e;return(e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}})[symbolObservable]=function(){return this},e}function createInvocableActor(t,e,n,i){var r,o=toInvokeSource$1(t.src),a=null===(r=null==e?void 0:e.options.services)||void 0===r?void 0:r[o.type],s=t.data?mapContext(t.data,n,i):void 0,c=a?createDeferredActor(a,t.id,s):createNullActor(t.id);return c.meta=t,c}function createDeferredActor(t,e,n){var i=createNullActor(e);if(i.deferred=!0,isMachine(t)){var r=i.state=provide(void 0,(function(){return(n?t.withContext(n):t).initialState}));i.getSnapshot=function(){return r}}return i}function isActor(t){try{return"function"==typeof t.send}catch(t){return!1}}function isSpawnedActor(t){return isActor(t)&&"id"in t}function toActorRef(t){var e;return __assign(((e={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}})[symbolObservable]=function(){return this},e),t)}var isLeafNode=function(t){return"atomic"===t.type||"final"===t.type};function getAllChildren(t){return Object.keys(t.states).map((function(e){return t.states[e]}))}function getChildren(t){return getAllChildren(t).filter((function(t){return"history"!==t.type}))}function getAllStateNodes(t){var e=[t];return isLeafNode(t)?e:e.concat(flatten(getChildren(t).map(getAllStateNodes)))}function getConfiguration(t,e){var n,i,r,o,a,s,c,u,l=getAdjList(new Set(t)),h=new Set(e);try{for(var d=__values(h),f=d.next();!f.done;f=d.next())for(var p=(x=f.value).parent;p&&!h.has(p);)h.add(p),p=p.parent}catch(t){n={error:t}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}var v=getAdjList(h);try{for(var y=__values(h),g=y.next();!g.done;g=y.next()){if("compound"!==(x=g.value).type||v.get(x)&&v.get(x).length){if("parallel"===x.type)try{for(var _=(a=void 0,__values(getChildren(x))),S=_.next();!S.done;S=_.next()){var m=S.value;h.has(m)||(h.add(m),l.get(m)?l.get(m).forEach((function(t){return h.add(t)})):m.initialStateNodes.forEach((function(t){return h.add(t)})))}}catch(t){a={error:t}}finally{try{S&&!S.done&&(s=_.return)&&s.call(_)}finally{if(a)throw a.error}}}else l.get(x)?l.get(x).forEach((function(t){return h.add(t)})):x.initialStateNodes.forEach((function(t){return h.add(t)}))}}catch(t){r={error:t}}finally{try{g&&!g.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}try{for(var E=__values(h),b=E.next();!b.done;b=E.next()){var x;for(p=(x=b.value).parent;p&&!h.has(p);)h.add(p),p=p.parent}}catch(t){c={error:t}}finally{try{b&&!b.done&&(u=E.return)&&u.call(E)}finally{if(c)throw c.error}}return h}function getValueFromAdj(t,e){var n=e.get(t);if(!n)return{};if("compound"===t.type){var i=n[0];if(!i)return{};if(isLeafNode(i))return i.key}var r={};return n.forEach((function(t){r[t.key]=getValueFromAdj(t,e)})),r}function getAdjList(t){var e,n,i=new Map;try{for(var r=__values(t),o=r.next();!o.done;o=r.next()){var a=o.value;i.has(a)||i.set(a,[]),a.parent&&(i.has(a.parent)||i.set(a.parent,[]),i.get(a.parent).push(a))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return i}function getValue(t,e){return getValueFromAdj(t,getAdjList(getConfiguration([t],e)))}function has(t,e){return Array.isArray(t)?t.some((function(t){return t===e})):t instanceof Set&&t.has(e)}function nextEvents(t){return __spreadArray([],__read(new Set(flatten(__spreadArray([],__read(t.map((function(t){return t.ownEvents}))),!1)))),!1)}function isInFinalState(t,e){return"compound"===e.type?getChildren(e).some((function(e){return"final"===e.type&&has(t,e)})):"parallel"===e.type&&getChildren(e).every((function(e){return isInFinalState(t,e)}))}function getMeta(t){return void 0===t&&(t=[]),t.reduce((function(t,e){return void 0!==e.meta&&(t[e.id]=e.meta),t}),{})}function getTagsFromConfiguration(t){return new Set(flatten(t.map((function(t){return t.tags}))))}function stateValuesEqual(t,e){if(t===e)return!0;if(void 0===t||void 0===e)return!1;if(isString(t)||isString(e))return t===e;var n=Object.keys(t),i=Object.keys(e);return n.length===i.length&&n.every((function(n){return stateValuesEqual(t[n],e[n])}))}function isStateConfig(t){return"object"==typeof t&&null!==t&&("value"in t&&"_event"in t)}function bindActionToState(t,e){var n=t.exec;return __assign(__assign({},t),{exec:void 0!==n?function(){return n(e.context,e.event,{action:t,state:e,_event:e._event})}:void 0})}var State=function(){function t(t){var e,n=this;this.actions=[],this.activities=EMPTY_ACTIVITY_MAP,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||EMPTY_ACTIVITY_MAP,this.meta=getMeta(t.configuration),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=null!==(e=Array.isArray(t.tags)?new Set(t.tags):t.tags)&&void 0!==e?e:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return nextEvents(n.configuration)}})}return t.from=function(e,n){return e instanceof t?e.context!==n?new t({value:e.value,context:n,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e:new t({value:e,context:n,_event:initEvent,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,n){if(e instanceof t){if(!e.actions.length)return e;var i=initEvent;return new t({value:e.value,context:n,_event:i,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,n)},t.prototype.toStrings=function(t,e){var n=this;if(void 0===t&&(t=this.value),void 0===e&&(e="."),isString(t))return[t];var i=Object.keys(t);return i.concat.apply(i,__spreadArray([],__read(i.map((function(i){return n.toStrings(t[i],e).map((function(t){return i+e+t}))}))),!1))},t.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var e=t.tags;t.machine;var n=__rest(t,["configuration","transitions","tags","machine"]);return __assign(__assign({},n),{tags:Array.from(e)})},t.prototype.matches=function(t){return matchesState(t,this.value)},t.prototype.hasTag=function(t){return this.tags.has(t)},t.prototype.can=function(t){var e;warn(!!this.machine);var n=null===(e=this.machine)||void 0===e?void 0:e.getTransitionData(this,t);return!!(null==n?void 0:n.transitions.length)&&n.transitions.some((function(t){return void 0!==t.target||t.actions.length}))},t}(),defaultOptions={deferEvents:!1},Scheduler=function(){function t(t){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=__assign(__assign({},defaultOptions),t)}return t.prototype.initialize=function(t){if(this.initialized=!0,t){if(!this.options.deferEvents)return void this.schedule(t);this.process(t)}this.flushEvents()},t.prototype.schedule=function(t){if(this.initialized&&!this.processingEvent){if(0!==this.queue.length)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()}else this.queue.push(t)},t.prototype.clear=function(){this.queue=[]},t.prototype.flushEvents=function(){for(var t=this.queue.shift();t;)this.process(t),t=this.queue.shift()},t.prototype.process=function(t){this.processingEvent=!0;try{t()}catch(t){throw this.clear(),t}finally{this.processingEvent=!1}},t}(),children=new Map,sessionIdIndex=0,registry={bookId:function(){return"x:".concat(sessionIdIndex++)},register:function(t,e){return children.set(t,e),t},get:function(t){return children.get(t)},free:function(t){children.delete(t)}};function getGlobal(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0}function getDevTools(){var t=getGlobal();if(t&&"__xstate__"in t)return t.__xstate__}function registerService(t){if(getGlobal()){var e=getDevTools();e&&e.register(t)}}function spawnBehavior(t,e){void 0===e&&(e={});var n=t.initialState,i=new Set,r=[],o=!1,a=toActorRef({id:e.id,send:function(e){r.push(e),function(){if(!o){for(o=!0;r.length>0;){var e=r.shift();n=t.transition(n,e,s),i.forEach((function(t){return t.next(n)}))}o=!1}}()},getSnapshot:function(){return n},subscribe:function(t,e,r){var o=toObserver(t,e,r);return i.add(o),o.next(n),{unsubscribe:function(){i.delete(o)}}}}),s={parent:e.parent,self:a,id:e.id||"anonymous",observers:i};return n=t.start?t.start(s):n,a}var DEFAULT_SPAWN_OPTIONS={sync:!1,autoForward:!1},InterpreterStatus;!function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"}(InterpreterStatus||(InterpreterStatus={}));var Interpreter=function(){function t(e,n){var i=this;void 0===n&&(n=t.defaultOptions),this.machine=e,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=InterpreterStatus.NotStarted,this.children=new Map,this.forwardTo=new Set,this.init=this.start,this.send=function(t,e){if(isArray(t))return i.batch(t),i.state;var n=toSCXMLEvent(toEventObject(t,e));if(i.status===InterpreterStatus.Stopped)return i.state;if(i.status!==InterpreterStatus.Running&&!i.options.deferEvents)throw new Error('Event "'.concat(n.name,'" was sent to uninitialized service "').concat(i.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\nEvent: ').concat(JSON.stringify(n.data)));return i.scheduler.schedule((function(){i.forward(n);var t=i.nextState(n);i.update(t,n)})),i._state},this.sendTo=function(t,e){var n=i.parent&&(e===SpecialTargets.Parent||i.parent.id===e),r=n?i.parent:isString(e)?i.children.get(e)||registry.get(e):isActor$1(e)?e:void 0;if(r)"machine"in r?(i.status!==InterpreterStatus.Stopped||i.parent!==r||i.state.done)&&r.send(__assign(__assign({},t),{name:t.name===error$1?"".concat(error(i.id)):t.name,origin:i.sessionId})):r.send(t.data);else if(!n)throw new Error("Unable to send event to child '".concat(e,"' from service '").concat(i.id,"'."))},this._exec=function(t,e,n,r){void 0===r&&(r=i.machine.options.actions);var o=t.exec||getActionFunction(t.type,r),a=isFunction(o)?o:o?o.exec:t.exec;if(a)try{return a(e,n.data,i.machine.config.predictableActionArguments?{action:t,_event:n}:{action:t,state:i.state,_event:n})}catch(t){throw i.parent&&i.parent.send({type:"xstate.error",data:t}),t}switch(t.type){case send$1:var s=t;if("number"==typeof s.delay)return void i.defer(s);s.to?i.sendTo(s._event,s.to):i.send(s._event);break;case cancel$1:i.cancel(t.sendId);break;case start$1:if(i.status!==InterpreterStatus.Running)return;var c=t.activity;if(!i.machine.config.predictableActionArguments&&!i.state.activities[c.id||c.type])break;if(c.type===ActionTypes.Invoke){var u=toInvokeSource$1(c.src),l=i.machine.options.services?i.machine.options.services[u.type]:void 0,h=c.id,d=c.data,f="autoForward"in c?c.autoForward:!!c.forward;if(!l)return;var p=d?mapContext(d,e,n):void 0;if("string"==typeof l)return;var v=isFunction(l)?l(e,n.data,{data:p,src:u,meta:c.meta}):l;if(!v)return;var y=void 0;isMachine(v)&&(v=p?v.withContext(p):v,y={autoForward:f}),i.spawn(v,h,y)}else i.spawnActivity(c);break;case stop$1:i.stopChild(t.activity.id);break;case log:var g=t.label,_=t.value;g?i.logger(g,_):i.logger(_)}};var r=__assign(__assign({},t.defaultOptions),n),o=r.clock,a=r.logger,s=r.parent,c=r.id,u=void 0!==c?c:e.id;this.id=u,this.logger=a,this.clock=o,this.parent=s,this.options=r,this.scheduler=new Scheduler({deferEvents:this.options.deferEvents}),this.sessionId=registry.bookId()}return Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:provide(this,(function(){return t._initialState=t.machine.initialState,t._initialState}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.execute=function(t,e){var n,i;try{for(var r=__values(t.actions),o=r.next();!o.done;o=r.next()){var a=o.value;this.exec(a,t,e)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}},t.prototype.update=function(t,e){var n,i,r,o,a,s,c,u,l=this;if(t._sessionid=this.sessionId,this._state=t,this.machine.config.predictableActionArguments&&e!==initEvent||!this.options.execute||this.execute(this.state),this.children.forEach((function(t){l.state.children[t.id]=t})),this.devTools&&this.devTools.send(e.data,t),t.event)try{for(var h=__values(this.eventListeners),d=h.next();!d.done;d=h.next()){(0,d.value)(t.event)}}catch(t){n={error:t}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}try{for(var f=__values(this.listeners),p=f.next();!p.done;p=f.next()){(0,p.value)(t,t.event)}}catch(t){r={error:t}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}try{for(var v=__values(this.contextListeners),y=v.next();!y.done;y=v.next()){(0,y.value)(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(t){a={error:t}}finally{try{y&&!y.done&&(s=v.return)&&s.call(v)}finally{if(a)throw a.error}}if(this.state.done){var g=t.configuration.find((function(t){return"final"===t.type&&t.parent===l.machine})),_=g&&g.doneData?mapContext(g.doneData,t.context,e):void 0;try{for(var S=__values(this.doneListeners),m=S.next();!m.done;m=S.next()){(0,m.value)(doneInvoke(this.id,_))}}catch(t){c={error:t}}finally{try{m&&!m.done&&(u=S.return)&&u.call(S)}finally{if(c)throw c.error}}this._stop()}},t.prototype.onTransition=function(t){return this.listeners.add(t),this.status===InterpreterStatus.Running&&t(this.state,this.state.event),this},t.prototype.subscribe=function(t,e,n){var i=this,r=toObserver(t,e,n);this.listeners.add(r.next),this.status!==InterpreterStatus.NotStarted&&r.next(this.state);var o=function(){i.doneListeners.delete(o),i.stopListeners.delete(o),r.complete()};return this.status===InterpreterStatus.Stopped?r.complete():(this.onDone(o),this.onStop(o)),{unsubscribe:function(){i.listeners.delete(r.next),i.doneListeners.delete(o),i.stopListeners.delete(o)}}},t.prototype.onEvent=function(t){return this.eventListeners.add(t),this},t.prototype.onSend=function(t){return this.sendListeners.add(t),this},t.prototype.onChange=function(t){return this.contextListeners.add(t),this},t.prototype.onStop=function(t){return this.stopListeners.add(t),this},t.prototype.onDone=function(t){return this.doneListeners.add(t),this},t.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},t.prototype.start=function(t){var e=this;if(this.status===InterpreterStatus.Running)return this;this.machine._init(),registry.register(this.sessionId,this),this.initialized=!0,this.status=InterpreterStatus.Running;var n=void 0===t?this.initialState:provide(this,(function(){return isStateConfig(t)?e.machine.resolveState(t):e.machine.resolveState(State.from(t,e.machine.context))}));return this.options.devTools&&this.attachDev(),this.scheduler.initialize((function(){e.update(n,initEvent)})),this},t.prototype._stop=function(){var t,e,n,i,r,o,a,s,c,u;try{for(var l=__values(this.listeners),h=l.next();!h.done;h=l.next()){var d=h.value;this.listeners.delete(d)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}try{for(var f=__values(this.stopListeners),p=f.next();!p.done;p=f.next()){(d=p.value)(),this.stopListeners.delete(d)}}catch(t){n={error:t}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}try{for(var v=__values(this.contextListeners),y=v.next();!y.done;y=v.next()){d=y.value;this.contextListeners.delete(d)}}catch(t){r={error:t}}finally{try{y&&!y.done&&(o=v.return)&&o.call(v)}finally{if(r)throw r.error}}try{for(var g=__values(this.doneListeners),_=g.next();!_.done;_=g.next()){d=_.value;this.doneListeners.delete(d)}}catch(t){a={error:t}}finally{try{_&&!_.done&&(s=g.return)&&s.call(g)}finally{if(a)throw a.error}}if(!this.initialized)return this;this.initialized=!1,this.status=InterpreterStatus.Stopped,this._initialState=void 0;try{for(var S=__values(Object.keys(this.delayedEventsMap)),m=S.next();!m.done;m=S.next()){var E=m.value;this.clock.clearTimeout(this.delayedEventsMap[E])}}catch(t){c={error:t}}finally{try{m&&!m.done&&(u=S.return)&&u.call(S)}finally{if(c)throw c.error}}this.scheduler.clear(),this.scheduler=new Scheduler({deferEvents:this.options.deferEvents})},t.prototype.stop=function(){var t=this,e=this.scheduler;return this._stop(),e.schedule((function(){var e=toSCXMLEvent({type:"xstate.stop"}),n=provide(t,(function(){var n=flatten(__spreadArray([],__read(t.state.configuration),!1).sort((function(t,e){return e.order-t.order})).map((function(e){return toActionObjects(e.onExit,t.machine.options.actions)}))),i=__read(resolveActions(t.machine,t.state,t.state.context,e,n,t.machine.config.predictableActionArguments?t._exec:void 0,t.machine.config.predictableActionArguments||t.machine.config.preserveActionOrder),2),r=i[0],o=i[1],a=new State({value:t.state.value,context:o,_event:e,_sessionid:t.sessionId,historyValue:void 0,history:t.state,actions:r.filter((function(t){return t.type!==raise$1&&(t.type!==send$1||!!t.to&&t.to!==SpecialTargets.Internal)})),activities:{},events:[],configuration:[],transitions:[],children:{},done:t.state.done,tags:t.state.tags,machine:t.machine});return a.changed=!0,a}));t.update(n,e),t.children.forEach((function(t){isFunction(t.stop)&&t.stop()})),t.children.clear(),registry.free(t.sessionId)})),this},t.prototype.batch=function(t){var e=this;if(this.status===InterpreterStatus.NotStarted&&this.options.deferEvents);else if(this.status!==InterpreterStatus.Running)throw new Error("".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'));this.scheduler.schedule((function(){var n,i,r=e.state,o=!1,a=[],s=function(t){var n=toSCXMLEvent(t);e.forward(n),r=provide(e,(function(){return e.machine.transition(r,n)})),a.push.apply(a,__spreadArray([],__read(r.actions.map((function(t){return bindActionToState(t,r)}))),!1)),o=o||!!r.changed};try{for(var c=__values(t),u=c.next();!u.done;u=c.next()){s(u.value)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}r.changed=o,r.actions=a,e.update(r,toSCXMLEvent(t[t.length-1]))}))},t.prototype.sender=function(t){return this.send.bind(this,t)},t.prototype._nextState=function(t){var e=this,n=toSCXMLEvent(t);if(0===n.name.indexOf(errorPlatform)&&!this.state.nextEvents.some((function(t){return 0===t.indexOf(errorPlatform)})))throw n.data.data;return provide(this,(function(){return e.machine.transition(e.state,n,void 0,e.machine.config.predictableActionArguments?e._exec:void 0)}))},t.prototype.nextState=function(t){return this._nextState(t)},t.prototype.forward=function(t){var e,n;try{for(var i=__values(this.forwardTo),r=i.next();!r.done;r=i.next()){var o=r.value,a=this.children.get(o);if(!a)throw new Error("Unable to forward event '".concat(t,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(o,"'."));a.send(t)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},t.prototype.defer=function(t){var e=this;this.delayedEventsMap[t.id]=this.clock.setTimeout((function(){t.to?e.sendTo(t._event,t.to):e.send(t._event)}),t.delay)},t.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},t.prototype.exec=function(t,e,n){void 0===n&&(n=this.machine.options.actions),this._exec(t,e.context,e._event,n)},t.prototype.removeChild=function(t){var e;this.children.delete(t),this.forwardTo.delete(t),null===(e=this.state)||void 0===e||delete e.children[t]},t.prototype.stopChild=function(t){var e=this.children.get(t);e&&(this.removeChild(t),isFunction(e.stop)&&e.stop())},t.prototype.spawn=function(t,e,n){if(this.status!==InterpreterStatus.Running)return createDeferredActor(t,e);if(isPromiseLike(t))return this.spawnPromise(Promise.resolve(t),e);if(isFunction(t))return this.spawnCallback(t,e);if(isSpawnedActor(t))return this.spawnActor(t,e);if(isObservable(t))return this.spawnObservable(t,e);if(isMachine(t))return this.spawnMachine(t,__assign(__assign({},n),{id:e}));if(isBehavior(t))return this.spawnBehavior(t,e);throw new Error('Unable to spawn entity "'.concat(e,'" of type "').concat(typeof t,'".'))},t.prototype.spawnMachine=function(e,n){var i=this;void 0===n&&(n={});var r=new t(e,__assign(__assign({},this.options),{parent:this,id:n.id||e.id})),o=__assign(__assign({},DEFAULT_SPAWN_OPTIONS),n);o.sync&&r.onTransition((function(t){i.send(update,{state:t,id:r.id})}));var a=r;return this.children.set(r.id,a),o.autoForward&&this.forwardTo.add(r.id),r.onDone((function(t){i.removeChild(r.id),i.send(toSCXMLEvent(t,{origin:r.id}))})).start(),a},t.prototype.spawnBehavior=function(t,e){var n=spawnBehavior(t,{id:e,parent:this});return this.children.set(e,n),n},t.prototype.spawnPromise=function(t,e){var n,i,r=this,o=!1;t.then((function(t){o||(i=t,r.removeChild(e),r.send(toSCXMLEvent(doneInvoke(e,t),{origin:e})))}),(function(t){if(!o){r.removeChild(e);var n=error(e,t);try{r.send(toSCXMLEvent(n,{origin:e}))}catch(t){r.devTools&&r.devTools.send(n,r.state),r.machine.strict&&r.stop()}}}));var a=((n={id:e,send:function(){},subscribe:function(e,n,i){var r=toObserver(e,n,i),o=!1;return t.then((function(t){o||(r.next(t),o||r.complete())}),(function(t){o||r.error(t)})),{unsubscribe:function(){return o=!0}}},stop:function(){o=!0},toJSON:function(){return{id:e}},getSnapshot:function(){return i}})[symbolObservable]=function(){return this},n);return this.children.set(e,a),a},t.prototype.spawnCallback=function(t,e){var n,i,r,o=this,a=!1,s=new Set,c=new Set;try{r=t((function(t){i=t,c.forEach((function(e){return e(t)})),a||o.send(toSCXMLEvent(t,{origin:e}))}),(function(t){s.add(t)}))}catch(t){this.send(error(e,t))}if(isPromiseLike(r))return this.spawnPromise(r,e);var u=((n={id:e,send:function(t){return s.forEach((function(e){return e(t)}))},subscribe:function(t){var e=toObserver(t);return c.add(e.next),{unsubscribe:function(){c.delete(e.next)}}},stop:function(){a=!0,isFunction(r)&&r()},toJSON:function(){return{id:e}},getSnapshot:function(){return i}})[symbolObservable]=function(){return this},n);return this.children.set(e,u),u},t.prototype.spawnObservable=function(t,e){var n,i,r=this,o=t.subscribe((function(t){i=t,r.send(toSCXMLEvent(t,{origin:e}))}),(function(t){r.removeChild(e),r.send(toSCXMLEvent(error(e,t),{origin:e}))}),(function(){r.removeChild(e),r.send(toSCXMLEvent(doneInvoke(e),{origin:e}))})),a=((n={id:e,send:function(){},subscribe:function(e,n,i){return t.subscribe(e,n,i)},stop:function(){return o.unsubscribe()},getSnapshot:function(){return i},toJSON:function(){return{id:e}}})[symbolObservable]=function(){return this},n);return this.children.set(e,a),a},t.prototype.spawnActor=function(t,e){return this.children.set(e,t),t},t.prototype.spawnActivity=function(t){var e=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(e){var n=e(this.state.context,t);this.spawnEffect(t.id,n)}},t.prototype.spawnEffect=function(t,e){var n;this.children.set(t,((n={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:e||void 0,getSnapshot:function(){},toJSON:function(){return{id:t}}})[symbolObservable]=function(){return this},n))},t.prototype.attachDev=function(){var t=getGlobal();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){var e="object"==typeof this.options.devTools?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(__assign(__assign({name:this.id,autoPause:!0,stateSanitizer:function(t){return{value:t.value,context:t.context,actions:t.actions}}},e),{features:__assign({jump:!1,skip:!1},e?e.features:void 0)}),this.machine),this.devTools.init(this.state)}registerService(this)}},t.prototype.toJSON=function(){return{id:this.id}},t.prototype[symbolObservable]=function(){return this},t.prototype.getSnapshot=function(){return this.status===InterpreterStatus.NotStarted?this.initialState:this._state},t.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(t,e){return setTimeout(t,e)},clearTimeout:function(t){return clearTimeout(t)}},logger:console.log.bind(console),devTools:!1},t.interpret=interpret,t}();function interpret(t,e){return new Interpreter(t,e)}function toInvokeSource(t){if("string"==typeof t){var e={type:t,toString:function(){return t}};return e}return t}function toInvokeDefinition(t){return __assign(__assign({type:invoke},t),{toJSON:function(){t.onDone,t.onError;var e=__rest(t,["onDone","onError"]);return __assign(__assign({},e),{type:invoke,src:toInvokeSource(t.src)})}})}var NULL_EVENT="",STATE_IDENTIFIER="#",WILDCARD="*",EMPTY_OBJECT={},isStateId=function(t){return t[0]===STATE_IDENTIFIER},createDefaultOptions=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},StateNode=function(){function t(e,n,i,r){var o,a=this;void 0===i&&(i="context"in e?e.context:void 0),this.config=e,this._context=i,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(createDefaultOptions(),n),this.parent=null==r?void 0:r.parent,this.key=this.config.key||(null==r?void 0:r.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:STATE_DELIMITER),this.id=this.config.id||__spreadArray([this.machine.key],__read(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:null!==(o=this.config.schema)&&void 0!==o?o:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?mapValues(this.config.states,(function(e,n){var i,r=new t(e,{},void 0,{parent:a,key:n});return Object.assign(a.idMap,__assign(((i={})[r.id]=r,i),r.idMap)),r})):EMPTY_OBJECT;var s=0;!function t(e){var n,i;e.order=s++;try{for(var r=__values(getAllChildren(e)),o=r.next();!o.done;o=r.next()){t(o.value)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}}(this),this.history=!0===this.config.history?"shallow":this.config.history||!1,this._transient=!!this.config.always||!!this.config.on&&(Array.isArray(this.config.on)?this.config.on.some((function(t){return t.event===NULL_EVENT})):NULL_EVENT in this.config.on),this.strict=!!this.config.strict,this.onEntry=toArray(this.config.entry||this.config.onEntry).map((function(t){return toActionObject(t)})),this.onExit=toArray(this.config.exit||this.config.onExit).map((function(t){return toActionObject(t)})),this.meta=this.config.meta,this.doneData="final"===this.type?this.config.data:void 0,this.invoke=toArray(this.config.invoke).map((function(t,e){var n,i;if(isMachine(t)){var r=createInvokeId(a.id,e);return a.machine.options.services=__assign(((n={})[r]=t,n),a.machine.options.services),toInvokeDefinition({src:r,id:r})}if(isString(t.src)){r=t.id||createInvokeId(a.id,e);return toInvokeDefinition(__assign(__assign({},t),{id:r,src:t.src}))}if(isMachine(t.src)||isFunction(t.src)){r=t.id||createInvokeId(a.id,e);return a.machine.options.services=__assign(((i={})[r]=t.src,i),a.machine.options.services),toInvokeDefinition(__assign(__assign({id:r},t),{src:r}))}var o=t.src;return toInvokeDefinition(__assign(__assign({id:createInvokeId(a.id,e)},t),{src:o}))})),this.activities=toArray(this.config.activities).concat(this.invoke).map((function(t){return toActivityDefinition(t)})),this.transition=this.transition.bind(this),this.tags=toArray(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||getAllStateNodes(this).forEach((function(t){return t.on}))},t.prototype.withConfig=function(e,n){var i=this.options,r=i.actions,o=i.activities,a=i.guards,s=i.services,c=i.delays;return new t(this.config,{actions:__assign(__assign({},r),e.actions),activities:__assign(__assign({},o),e.activities),guards:__assign(__assign({},a),e.guards),services:__assign(__assign({},s),e.services),delays:__assign(__assign({},c),e.delays)},null!=n?n:this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return isFunction(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:mapValues(this.states,(function(t){return t.definition})),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce((function(t,e){return t[e.eventType]=t[e.eventType]||[],t[e.eventType].push(e),t}),{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var e=t===NULL_EVENT,n=this.transitions.filter((function(n){var i=n.eventType===t;return e?i:i||n.eventType===WILDCARD}));return this.__cache.candidates[t]=n,n},t.prototype.getDelayedTransitions=function(){var t=this,e=this.config.after;if(!e)return[];var n=function(e,n){var i=after(isFunction(e)?"".concat(t.id,":delay[").concat(n,"]"):e,t.id);return t.onEntry.push(send(i,{delay:e})),t.onExit.push(cancel(i)),i};return(isArray(e)?e.map((function(t,e){var i=n(t.delay,e);return __assign(__assign({},t),{event:i})})):flatten(Object.keys(e).map((function(t,i){var r=e[t],o=isString(r)?{target:r}:r,a=isNaN(+t)?t:+t,s=n(a,i);return toArray(o).map((function(t){return __assign(__assign({},t),{event:s,delay:a})}))})))).map((function(e){var n=e.delay;return __assign(__assign({},t.formatTransition(e)),{delay:n})}))},t.prototype.getStateNodes=function(t){var e,n=this;if(!t)return[];var i=t instanceof State?t.value:toStateValue(t,this.delimiter);if(isString(i)){var r=this.getStateNode(i).initial;return void 0!==r?this.getStateNodes(((e={})[i]=r,e)):[this,this.states[i]]}var o=Object.keys(i),a=[this];return a.push.apply(a,__spreadArray([],__read(flatten(o.map((function(t){return n.getStateNode(t).getStateNodes(i[t])})))),!1)),a},t.prototype.handles=function(t){var e=getEventType(t);return this.events.includes(e)},t.prototype.resolveState=function(t){var e=t instanceof State?t:State.create(t),n=Array.from(getConfiguration([],this.getStateNodes(e.value)));return new State(__assign(__assign({},e),{value:this.resolve(e.value),configuration:n,done:isInFinalState(n,this),tags:getTagsFromConfiguration(n),machine:this.machine}))},t.prototype.transitionLeafNode=function(t,e,n){var i=this.getStateNode(t).next(e,n);return i&&i.transitions.length?i:this.next(e,n)},t.prototype.transitionCompoundNode=function(t,e,n){var i=Object.keys(t),r=this.getStateNode(i[0])._transition(t[i[0]],e,n);return r&&r.transitions.length?r:this.next(e,n)},t.prototype.transitionParallelNode=function(t,e,n){var i,r,o={};try{for(var a=__values(Object.keys(t)),s=a.next();!s.done;s=a.next()){var c=s.value,u=t[c];if(u){var l=this.getStateNode(c)._transition(u,e,n);l&&(o[c]=l)}}}catch(t){i={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}var h=Object.keys(o).map((function(t){return o[t]})),d=flatten(h.map((function(t){return t.transitions})));if(!h.some((function(t){return t.transitions.length>0})))return this.next(e,n);var f=flatten(h.map((function(t){return t.entrySet}))),p=flatten(Object.keys(o).map((function(t){return o[t].configuration})));return{transitions:d,entrySet:f,exitSet:flatten(h.map((function(t){return t.exitSet}))),configuration:p,source:e,actions:flatten(Object.keys(o).map((function(t){return o[t].actions})))}},t.prototype._transition=function(t,e,n){return isString(t)?this.transitionLeafNode(t,e,n):1===Object.keys(t).length?this.transitionCompoundNode(t,e,n):this.transitionParallelNode(t,e,n)},t.prototype.getTransitionData=function(t,e){return this._transition(t.value,t,toSCXMLEvent(e))},t.prototype.next=function(t,e){var n,i,r,o=this,a=e.name,s=[],c=[];try{for(var u=__values(this.getCandidates(a)),l=u.next();!l.done;l=u.next()){var h=l.value,d=h.cond,f=h.in,p=t.context,v=!f||(isString(f)&&isStateId(f)?t.matches(toStateValue(this.getStateNodeById(f).path,this.delimiter)):matchesState(toStateValue(f,this.delimiter),path(this.path.slice(0,-2))(t.value))),y=!1;try{y=!d||evaluateGuard(this.machine,d,p,e,t)}catch(t){throw new Error("Unable to evaluate guard '".concat(d.name||d.type,"' in transition for event '").concat(a,"' in state node '").concat(this.id,"':\n").concat(t.message))}if(y&&v){void 0!==h.target&&(c=h.target),s.push.apply(s,__spreadArray([],__read(h.actions),!1)),r=h;break}}}catch(t){n={error:t}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}if(r){if(!c.length)return{transitions:[r],entrySet:[],exitSet:[],configuration:t.value?[this]:[],source:t,actions:s};var g=flatten(c.map((function(e){return o.getRelativeStateNodes(e,t.historyValue)}))),_=!!r.internal,S=[];return _||c.forEach((function(t){S.push.apply(S,__spreadArray([],__read(o.getExternalReentryNodes(t)),!1))})),{transitions:[r],entrySet:S,exitSet:_?[]:[this],configuration:g,source:t,actions:s}}},t.prototype.getExternalReentryNodes=function(t){for(var e=[],n=__read(t.order>this.order?[t,this]:[this,t],2),i=n[0],r=n[1];i&&i!==r;)e.push(i),i=i.parent;return i!==r?[]:(e.push(r),e)},t.prototype.getActions=function(t,e,n,i,r,o){var a,s,c,u,l=getConfiguration([],o?this.getStateNodes(o.value):[this]);try{for(var h=__values(t),d=h.next();!d.done;d=h.next()){has(l,v=d.value)&&!has(n.entrySet,v.parent)||n.entrySet.push(v)}}catch(t){a={error:t}}finally{try{d&&!d.done&&(s=h.return)&&s.call(h)}finally{if(a)throw a.error}}try{for(var f=__values(l),p=f.next();!p.done;p=f.next()){var v;has(t,v=p.value)&&!has(n.exitSet,v.parent)||n.exitSet.push(v)}}catch(t){c={error:t}}finally{try{p&&!p.done&&(u=f.return)&&u.call(f)}finally{if(c)throw c.error}}var y=flatten(n.entrySet.map((function(t){var e=[];if("final"!==t.type)return e;var o=t.parent;if(!o.parent)return e;e.push(done(t.id,t.doneData),done(o.id,t.doneData?mapContext(t.doneData,i,r):void 0));var a=o.parent;return"parallel"===a.type&&getChildren(a).every((function(t){return isInFinalState(n.configuration,t)}))&&e.push(done(a.id)),e})));n.exitSet.sort((function(t,e){return e.order-t.order})),n.entrySet.sort((function(t,e){return t.order-e.order}));var g=new Set(n.entrySet),_=new Set(n.exitSet),S=__read([flatten(Array.from(g).map((function(t){return __spreadArray(__spreadArray([],__read(t.activities.map((function(t){return start(t)}))),!1),__read(t.onEntry),!1)}))).concat(y.map(raise)),flatten(Array.from(_).map((function(t){return __spreadArray(__spreadArray([],__read(t.onExit),!1),__read(t.activities.map((function(t){return stop(t)}))),!1)})))],2),m=S[0],E=S[1],b=toActionObjects(E.concat(n.actions).concat(m),this.machine.options.actions);if(e){var x=toActionObjects(flatten(__spreadArray([],__read(t),!1).sort((function(t,e){return e.order-t.order})).map((function(t){return t.onExit}))),this.machine.options.actions).filter((function(t){return t.type!==raise$1&&(t.type!==send$1||!!t.to&&t.to!==SpecialTargets.Internal)}));return b.concat(x)}return b},t.prototype.transition=function(t,e,n,i){void 0===t&&(t=this.initialState);var r,o=toSCXMLEvent(e);if(t instanceof State)r=void 0===n?t:this.resolveState(State.from(t,n));else{var a=isString(t)?this.resolve(pathToStateValue(this.getResolvedPath(t))):this.resolve(t),s=null!=n?n:this.machine.context;r=this.resolveState(State.from(a,s))}if(this.strict&&!this.events.includes(o.name)&&!isBuiltInEvent(o.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(o.name,"'"));var c=this._transition(r.value,r,o)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:r,actions:[]},u=getConfiguration([],this.getStateNodes(r.value)),l=c.configuration.length?getConfiguration(u,c.configuration):u;return c.configuration=__spreadArray([],__read(l),!1),this.resolveTransition(c,r,r.context,i,o)},t.prototype.resolveRaisedTransition=function(t,e,n,i){var r,o=t.actions;return(t=this.transition(t,e,void 0,i))._event=n,t.event=n.data,(r=t.actions).unshift.apply(r,__spreadArray([],__read(o),!1)),t},t.prototype.resolveTransition=function(t,e,n,i,r){var o,a,s=this;void 0===r&&(r=initEvent);var c=t.configuration,u=!e||t.transitions.length>0,l=u?t.configuration:e?e.configuration:[],h=isInFinalState(l,this),d=u?getValue(this.machine,c):void 0,f=e?e.historyValue?e.historyValue:t.source?this.machine.historyValue(e.value):void 0:void 0,p=this.getActions(new Set(l),h,t,n,r,e),v=e?__assign({},e.activities):{};try{for(var y=__values(p),g=y.next();!g.done;g=y.next()){var _=g.value;_.type===start$1?v[_.activity.id||_.activity.type]=_:_.type===stop$1&&(v[_.activity.id||_.activity.type]=!1)}}catch(t){o={error:t}}finally{try{g&&!g.done&&(a=y.return)&&a.call(y)}finally{if(o)throw o.error}}var S=__read(resolveActions(this,e,n,r,p,i,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),m=S[0],E=S[1],b=__read(partition(m,(function(t){return t.type===raise$1||t.type===send$1&&t.to===SpecialTargets.Internal})),2),x=b[0],T=b[1],A=m.filter((function(t){var e;return t.type===start$1&&(null===(e=t.activity)||void 0===e?void 0:e.type)===invoke})),w=A.reduce((function(t,e){return t[e.activity.id]=createInvocableActor(e.activity,s.machine,E,r),t}),e?__assign({},e.children):{}),I=new State({value:d||e.value,context:E,_event:r,_sessionid:e?e._sessionid:null,historyValue:d?f?updateHistoryValue(f,d):void 0:e?e.historyValue:void 0,history:!d||t.source?e:void 0,actions:d?T:[],activities:d?v:e?e.activities:{},events:[],configuration:l,transitions:t.transitions,children:w,done:h,tags:getTagsFromConfiguration(l),machine:this}),O=n!==E;I.changed=r.name===update||O;var L=I.history;L&&delete L.history;var D=!h&&(this._transient||c.some((function(t){return t._transient})));if(!(u||D&&r.name!==NULL_EVENT))return I;var N=I;if(!h)for(D&&(N=this.resolveRaisedTransition(N,{type:nullEvent},r,i));x.length;){var k=x.shift();N=this.resolveRaisedTransition(N,k._event,r,i)}var P=N.changed||(L?!!N.actions.length||O||typeof L.value!=typeof N.value||!stateValuesEqual(N.value,L.value):void 0);return N.changed=P,N.history=L,N},t.prototype.getStateNode=function(t){if(isStateId(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var e=this.states[t];if(!e)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return e},t.prototype.getStateNodeById=function(t){var e=isStateId(t)?t.slice(STATE_IDENTIFIER.length):t;if(e===this.id)return this;var n=this.machine.idMap[e];if(!n)throw new Error("Child state node '#".concat(e,"' does not exist on machine '").concat(this.id,"'"));return n},t.prototype.getStateNodeByPath=function(t){if("string"==typeof t&&isStateId(t))try{return this.getStateNodeById(t.slice(1))}catch(t){}for(var e=toStatePath(t,this.delimiter).slice(),n=this;e.length;){var i=e.shift();if(!i.length)break;n=n.getStateNode(i)}return n},t.prototype.resolve=function(t){var e,n=this;if(!t)return this.initialStateValue||EMPTY_OBJECT;switch(this.type){case"parallel":return mapValues(this.initialStateValue,(function(e,i){return e?n.getStateNode(i).resolve(t[i]||e):EMPTY_OBJECT}));case"compound":if(isString(t)){var i=this.getStateNode(t);return"parallel"===i.type||"compound"===i.type?((e={})[t]=i.initialStateValue,e):t}return Object.keys(t).length?mapValues(t,(function(t,e){return t?n.getStateNode(e).resolve(t):EMPTY_OBJECT})):this.initialStateValue||{};default:return t||EMPTY_OBJECT}},t.prototype.getResolvedPath=function(t){if(isStateId(t)){var e=this.machine.idMap[t.slice(STATE_IDENTIFIER.length)];if(!e)throw new Error("Unable to find state node '".concat(t,"'"));return e.path}return toStatePath(t,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var t,e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;if("parallel"===this.type)e=mapFilterValues(this.states,(function(t){return t.initialStateValue||EMPTY_OBJECT}),(function(t){return!("history"===t.type)}));else if(void 0!==this.initial){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));e=isLeafNode(this.states[this.initial])?this.initial:((t={})[this.initial]=this.states[this.initial].initialStateValue,t)}else e={};return this.__cache.initialStateValue=e,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(t,e){this._init();var n=this.getStateNodes(t);return this.resolveTransition({configuration:n,entrySet:__spreadArray([],__read(n),!1),exitSet:[],transitions:[],source:void 0,actions:[]},void 0,null!=e?e:this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var t;if("history"===this.type){var e=this.config;t=isString(e.target)&&isStateId(e.target)?pathToStateValue(this.machine.getStateNodeById(e.target).path.slice(this.path.length-1)):e.target}return t},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(t,e,n){return void 0===n&&(n=!0),n?"history"===t.type?t.resolveHistory(e):t.initialStateNodes:[t]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var t=this;return isLeafNode(this)?[this]:"compound"!==this.type||this.initial?flatten(toStatePaths(this.initialStateValue).map((function(e){return t.getFromRelativePath(e)}))):[this]},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var e=__read(t),n=e[0],i=e.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var r=this.getStateNode(n);if("history"===r.type)return r.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(i)},t.prototype.historyValue=function(t){if(Object.keys(this.states).length)return{current:t||this.initialStateValue,states:mapFilterValues(this.states,(function(e,n){if(!t)return e.historyValue();var i=isString(t)?void 0:t[n];return e.historyValue(i||e.initialStateValue)}),(function(t){return!t.history}))}},t.prototype.resolveHistory=function(t){var e=this;if("history"!==this.type)return[this];var n=this.parent;if(!t){var i=this.target;return i?flatten(toStatePaths(i).map((function(t){return n.getFromRelativePath(t)}))):n.initialStateNodes}var r=nestedPath(n.path,"states")(t).current;return isString(r)?[n.getStateNode(r)]:flatten(toStatePaths(r).map((function(t){return"deep"===e.history?n.getFromRelativePath(t):[n.states[t[0]]]})))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var t=this,e=flatten(Object.keys(this.states).map((function(e){return t.states[e].stateIds})));return[this.id].concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var t,e,n,i;if(this.__cache.events)return this.__cache.events;var r=this.states,o=new Set(this.ownEvents);if(r)try{for(var a=__values(Object.keys(r)),s=a.next();!s.done;s=a.next()){var c=r[s.value];if(c.states)try{for(var u=(n=void 0,__values(c.events)),l=u.next();!l.done;l=u.next()){var h=l.value;o.add("".concat(h))}}catch(t){n={error:t}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter((function(t){return!(!t.target&&!t.actions.length&&t.internal)})).map((function(t){return t.eventType})));return Array.from(t)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(t){var e=this;if(void 0!==t)return t.map((function(t){if(!isString(t))return t;var n=t[0]===e.delimiter;if(n&&!e.parent)return e.getStateNodeByPath(t.slice(1));var i=n?e.key+t:t;if(!e.parent)return e.getStateNodeByPath(i);try{return e.parent.getStateNodeByPath(i)}catch(t){throw new Error("Invalid transition definition for state node '".concat(e.id,"':\n").concat(t.message))}}))},t.prototype.formatTransition=function(t){var e=this,n=normalizeTarget(t.target),i="internal"in t?t.internal:!n||n.some((function(t){return isString(t)&&t[0]===e.delimiter})),r=this.machine.options.guards,o=this.resolveTarget(n),a=__assign(__assign({},t),{actions:toActionObjects(toArray(t.actions)),cond:toGuard(t.cond,r),target:o,source:this,internal:i,eventType:t.event,toJSON:function(){return __assign(__assign({},a),{target:a.target?a.target.map((function(t){return"#".concat(t.id)})):void 0,source:"#".concat(e.id)})}});return a},t.prototype.formatTransitions=function(){var t,e,n,i=this;if(this.config.on)if(Array.isArray(this.config.on))n=this.config.on;else{var r=this.config.on,o=WILDCARD,a=r[o],s=void 0===a?[]:a,c=__rest(r,["symbol"==typeof o?o:o+""]);n=flatten(Object.keys(c).map((function(t){return toTransitionConfigArray(t,c[t])})).concat(toTransitionConfigArray(WILDCARD,s)))}else n=[];var u=this.config.always?toTransitionConfigArray("",this.config.always):[],l=this.config.onDone?toTransitionConfigArray(String(done(this.id)),this.config.onDone):[],h=flatten(this.invoke.map((function(t){var e=[];return t.onDone&&e.push.apply(e,__spreadArray([],__read(toTransitionConfigArray(String(doneInvoke(t.id)),t.onDone)),!1)),t.onError&&e.push.apply(e,__spreadArray([],__read(toTransitionConfigArray(String(error(t.id)),t.onError)),!1)),e}))),d=this.after,f=flatten(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],__read(l),!1),__read(h),!1),__read(n),!1),__read(u),!1).map((function(t){return toArray(t).map((function(t){return i.formatTransition(t)}))})));try{for(var p=__values(d),v=p.next();!v.done;v=p.next()){var y=v.value;f.push(y)}}catch(e){t={error:e}}finally{try{v&&!v.done&&(e=p.return)&&e.call(p)}finally{if(t)throw t.error}}return f},t}(),warned=!1;function createMachine(t,e){return IS_PRODUCTION||t.predictableActionArguments||warned||(warned=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new StateNode(t,e)}var assign=assign$1;function __awaiter(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function s(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))}function isDigit(t){return/^\d$/.test(t)}function isNumeric(t){return/^\d+(\.\d*)?$/.test(t)}const OPERATORS=["+","-","*","/"];function isOperator(t){return OPERATORS.includes(t)}const calcMachine=createMachine({schema:{events:{},services:{}},tsTypes:{},context:{input:["0"]},id:"calc",initial:"idle",states:{idle:{entry:"resetInput",on:{DIGIT:{actions:"appendDigitToInput",target:"int"},DECIMAL_POINT:{actions:"appendDecimalPointToInput",target:"fraction"},OPERATOR:{actions:"appendOperatorToInput",target:"operator"}}},int:{on:{DIGIT:{actions:"appendDigitToInput",target:"int"},DECIMAL_POINT:{actions:"appendDecimalPointToInput",target:"fraction"},OPERATOR:{actions:"appendOperatorToInput",target:"operator"},SOLVE:{target:"solving"},DELETE:[{target:"idle",cond:"inputHasOnlyOneDigit"},{cond:"lastItemHasManyDigits",actions:"delete",target:"int"},{cond:"lastItemHasOnlyOneDigit",actions:"delete",target:"operator"}]}},fraction:{on:{DIGIT:{actions:"appendDigitToInput",target:"fraction"},OPERATOR:{actions:"appendOperatorToInput",target:"operator"},SOLVE:{target:"solving"},DELETE:[{actions:"delete",target:"fraction",cond:"lastItemEndsWithDigit"},{actions:"delete",target:"int"}]}},operator:{on:{DIGIT:{actions:"appendDigitToInput",target:"int"},OPERATOR:{actions:"replaceLastOperator",target:"operator"},DECIMAL_POINT:{actions:"appendDecimalPointToInput",target:"fraction"},DELETE:[{actions:"delete",target:"fraction",cond:"prevToLastItemHasDecimalPoint"},{actions:"delete",target:"int"}]}},solving:{invoke:{src:"solveInput",onDone:"solution.result",onError:"solution.error"}},solution:{type:"compound",on:{DIGIT:{actions:["resetInput","appendDigitToInput"],target:"int"},DECIMAL_POINT:{actions:["resetInput","appendDecimalPointToInput"],target:"fraction"},ERROR:{target:"solution.error"},DELETE:{target:"idle"}},states:{result:{entry:"setResult",on:{OPERATOR:{actions:"appendOperatorToInput",target:"#calc.operator"}}},error:{entry:"setMathError"}}}},on:{RESET:{target:"idle"}}},{actions:{resetInput:assign({input:["0"]}),appendDigitToInput:assign({input:(t,e)=>{const{input:n}=t,i=n.at(-1);return isNumeric(i)?"0"===i?[...exceptLast(n),e.data]:[...exceptLast(n),i+e.data]:[...n,e.data]}}),appendDecimalPointToInput:assign({input:t=>{const e=t.input.at(-1);return isOperator(e)?[...t.input,"0."]:[...exceptLast(t.input),e+"."]}}),appendOperatorToInput:assign({input:(t,e)=>[...t.input,e.data]}),replaceLastOperator:assign({input:(t,e)=>[...exceptLast(t.input),e.data]}),setResult:assign({input:(t,e)=>[e.data]}),setMathError:assign({input:["MathError"]}),delete:assign({input:t=>{const{input:e}=t,n=e.at(-1);return 1===n.length?[...exceptLast(e)]:[...exceptLast(e),exceptLast(n)]}})},services:{solveInput(context){return __awaiter(this,void 0,void 0,(function*(){const concatted=context.input.join(""),result=eval(concatted);if(Number.isFinite(result))return result.toString();throw new Error("MathError: "+result)}))}},guards:{inputHasOnlyOneDigit:t=>1===t.input.length&&1===t.input.at(-1).length,lastItemHasManyDigits:t=>t.input.at(-1).length>1,lastItemHasOnlyOneDigit:t=>1===t.input.at(-1).length,lastItemEndsWithDigit:t=>isDigit(t.input.at(-1).at(-1)),prevToLastItemHasDecimalPoint:t=>t.input.at(-2).includes(".")}});function exceptLast(t){return t.slice(0,t.length-1)}const themeSwitch=document.querySelectorAll("input[name='themeSwitch']");themeSwitch.forEach((t=>{t.addEventListener("change",(()=>{document.documentElement.dataset.theme=t.value}))}));const calcService=interpret(calcMachine).start(),outputEl=document.querySelector("output");calcService.onTransition((t=>{t.changed&&(outputEl.textContent=t.context.input.map((t=>isNumeric(t)?formatNumStr(t):t)).map((t=>"*"===t?"×":t)).join(""),console.log(`State '${t.toStrings().join(" ")}'. Input ${JSON.stringify(t.context.input)}`))}));const keyEls=document.querySelectorAll(".Key");function handleKey(t){isDigit(t)?calcService.send({type:"DIGIT",data:t}):isOperator(t)||"Plus"===t?calcService.send({type:"OPERATOR",data:"Plus"===t?"+":t}):"."===t?calcService.send({type:"DECIMAL_POINT"}):"Delete"===t?calcService.send({type:"RESET"}):"="===t||"Enter"===t?calcService.send({type:"SOLVE"}):"Backspace"===t?calcService.send({type:"DELETE"}):console.error("Unknown key",t)}function formatNumStr(t){const[e,n]=t.split(".");let i=formatIntStr(e);return void 0!==n&&(i+="."+n),i}function formatIntStr(t){let e="";const n=t.length;for(let i=1;i<=n;i++){e=(i%3==0&&i<n?",":"")+t[n-i]+e}return e}keyEls.forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault();handleKey(t.getAttribute("aria-keyshortcuts")),outputEl.focus()}))})),outputEl.addEventListener("keyup",(t=>{handleKey(t.key)}))})();
//# sourceMappingURL=bundle.js.map
